
# =========================================================
# Stage 1：文件级压缩理解（允许感知来源，但不输出）
# =========================================================

STAGE1_SYSTEM_PROMPT = (
    "你是一名高校学术评审助手，负责对单个作品内容进行高度压缩理解。"
)

def build_stage1_user_prompt(material: str) -> str:
    return f"""
请对以下【作品内容】进行高度压缩理解。

要求：
1. 提炼 3–5 条与研究内容直接相关的关键信息
2. 仅关注研究主题、方法、对象、结论、创新点
3. 不提及任何文件、图片、PPT、视频、格式、载体
4. 不进行任何评分
5. 使用 JSON 输出：

{{
  "key_points": ["研究内容要点"],
  "academic_keywords": ["具体研究关键词"],
  "innovation_signal": "low | moderate | high"
}}

作品内容：
----------------
{material}
----------------
"""


# =========================================================
# Stage 2：作品级综合评分（语言强约束版）
# =========================================================

STAGE2_SYSTEM_PROMPT = (
    "你是一名高校研究生创新论坛评审专家。"
    "你只能从【学术作品本身】进行评价，"
    "你的评语必须符合正式评审语言规范。"
    "严禁提及任何文件、材料、图片、PPT、视频、格式、帧率、整理过程或技术环节。"
)

def build_stage2_user_prompt(merged_summaries: str, locked_schema=None) -> str:
    schema_text = ""
    if locked_schema:
        schema_text = (
            "【评分项已锁定】本批次所有作品必须严格使用以下评分项，不得改名或新增：\n"
            + "\n".join(f"- {k}" for k in locked_schema)
        )

    return f"""
请根据以下【作品研究内容摘要】进行综合评分。

{schema_text}

评分与评语要求（必须严格遵守）：
1. 评价对象只能是“作品本身的研究内容与学术表达”
2. 评语中不得出现以下任何词语或同类表达：
   - 文件、文档、材料、图片、PPT、视频、帧、格式、截图、解析、整理
3. 不得描述“观看”“阅读”“呈现方式”
4. 评语必须直接围绕研究问题、研究方法、创新点、学术价值
5. 评语中必须自然出现作品中的具体学术关键词或研究术语
6. 给出 50–80 字评语
7. 各评分项分数之和为 100，建议每个选手总分必须在65-95之间，大多数人在75-85之间
8. 使用 JSON 输出，格式如下：

{{
  "scores": {{
    "评分项(满分)": int
  }},
  "comment": "评语正文"
}}

作品研究内容摘要：
----------------
{merged_summaries}
----------------
"""

# =========================================================
# 兜底：仅生成评语（同样禁止技术痕迹）
# =========================================================

COMMENT_ONLY_SYSTEM_PROMPT = (
    "你是一名高校学术评审专家，仅对学术作品本身进行评价。"
    "严禁提及任何文件、材料、图片、PPT、视频或技术处理过程。"
)

def build_comment_only_prompt(merged_summaries: str) -> str:
    return f"""
请基于以下【作品研究内容摘要】生成一段 50–80 字的评语。

要求：
1. 仅评价研究内容与学术价值
2. 必须引用作品中的具体研究关键词
3. 不出现任何文件、图片、视频、材料、格式等词语
4. 语气客观、正式、符合学术评审口径
5. 只输出评语正文，不输出其他内容

作品研究内容摘要：
----------------
{merged_summaries}
----------------
"""